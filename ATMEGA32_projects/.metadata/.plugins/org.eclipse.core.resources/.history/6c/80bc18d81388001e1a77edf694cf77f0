/*
 * main.c
 * Description: Door access control system using AVR microcontroller
 * Author: AhmedAbogabl
 * Created on: Oct 17, 2023
 */

#include <avr/delay.h>

#include "MCAL/DIO/DIO_interface.h"
#include "MCAL/PORT/PORT.h"
#include "MCAL/GI/GI_interface.h"
#include "MCAL/UART/includes/UART_interface.h"
#include "HAL/SRVM/SRVM_interface.h"
//#include <avr/io.h>
//#include <util/delay.h>

#include "HAL/MOTOR/WHM.h"

int main(void) {

    Port_Init(pin_cfg);
    TMR0_voidInit();
//    Lcd_Init();
//    UART_Init();
//    SPI_voidInit();
//    EEPROM_voidInit();
//    GI_voidEnable();

    /* Initialize the motor driver */
    MOTOR_voidInit();

    while (1) {

        _delay_ms(1000);  // Run for 5 seconds

        /* Test the steering motor in clockwise direction */
        MOTOR_voidOn(STEERING_MOTOR, MOTOR_CW);
        //MOTOR_voidControlSpeed(STEERING_MOTOR, 50);  // Adjust speed as needed
        _delay_ms(1000);  // Run for 5 seconds

        /* Test the steering motor in clockwise direction */
        MOTOR_voidOn(STEERING_MOTOR, MOTOR_CCW);
        //MOTOR_voidControlSpeed(STEERING_MOTOR, 50);  // Adjust speed as needed
        _delay_ms(1000);  // Run for 5 seconds
        MOTOR_voidOff(STEERING_MOTOR);

    	/* Delay before testing the steering motor */
            _delay_ms(1000);

            /* Test the speed motor in clockwise direction */
            MOTOR_voidOn(SPEED_MOTOR, MOTOR_CW);
            MOTOR_voidControlSpeed(SPEED_MOTOR, 50);  // Adjust speed as needed
            _delay_ms(1000);  // Run for 5 seconds
            MOTOR_voidOff(SPEED_MOTOR);
            MOTOR_voidOn(SPEED_MOTOR, MOTOR_CCW);
            MOTOR_voidControlSpeed(SPEED_MOTOR, 50);  // Adjust speed as needed
            _delay_ms(1000);  // Run for 5 seconds
            MOTOR_voidOff(SPEED_MOTOR);


            /* Delay before repeating the task */
            _delay_ms(1000);
        }

        /* Never reach here */
        return 0;
    }
