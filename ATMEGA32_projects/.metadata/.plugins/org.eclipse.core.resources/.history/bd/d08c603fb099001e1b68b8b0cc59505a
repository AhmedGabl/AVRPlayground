/*
 * main.c
 * Description: automotive ecu resposible for whm bluetooth control and some auculery functions
 * Author: AhmedAbogabl
 * Created on: Oct 17, 2023
 */


#include "APP/ADAS_APP.h"


/*
 * *****************************************************************************************
 */



/***********************************************************************************************************************
 *
 */

//Spi communication  managemnt
u8 Spi_ResponseOnceFlag = NOT_YET;
u8 Spi_Request = NULL;

void Spi_Router(u8 Copy_u8RxData)
{           // UART_TransmitString("inside SPI_ROUTER \r\n");

	static u8 GIVE_CONTROL = FALSE ;

//	if(Copy_u8RxData == APP_VEHICLE_ACCESS_INFO_REQUEST )
//	{//UART_TransmitString("inside SPI_ROUTER    1\r\n");
//
//		if(VehicleAccess == TRUE)
//		Spi_Request = APP_VEHICLE_UNLOCKED;
//		Spi_ResponseOnceFlag = NOT_YET;
//	}
//	else
		if(Copy_u8RxData == APP_MOTORS_CONTROL_REQUEST)
	{//UART_TransmitString("inside SPI_ROUTER    2\r\n");

     	 GIVE_CONTROL = TRUE;
  	   	 Spi_ResponseOnceFlag = NOT_YET;
	}
	else if (GIVE_CONTROL == TRUE)
	{//UART_TransmitString("inside SPI_ROUTER    3\r\n");

		BT_read_vlaue = Copy_u8RxData;
		ButtonState = 0;
		GIVE_CONTROL = FALSE;
		Spi_ResponseOnceFlag = NOT_YET;
	}
	else
	{
	//	UART_TransmitString("inside SPI_ROUTER    4\r\n");
		Spi_ResponseOnceFlag = NOT_YET;
	}
}

int main(void) {
	HW_init();

	while (1) {
        WHM();
        if(Spi_ResponseOnceFlag == NOT_YET)
        {
           // UART_TransmitString("inside SPI \r\n");
        	SPI_voidTransmitAsynchronous(Spi_Request,Spi_Router);
        	Spi_Request = NULL;
        	Spi_ResponseOnceFlag = DONE;
        }
    }
    return 0;
}
