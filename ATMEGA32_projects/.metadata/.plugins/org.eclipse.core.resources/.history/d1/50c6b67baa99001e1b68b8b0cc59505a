/*
 * main.c

 *
 *  Created on: Oct 17, 2023
 *      Author: AhmedAbogabl
 */
//#define F_CPU 16000000UL
#include <avr/delay.h>
#include "MCAL/DIO/DIO_interface.h"
#include "MCAL/PORT/PORT.h"
#include "MCAL/SPI/includes/SPI_interface.h"
#include "MCAL/GI/GI_interface.h"
#include "ADAS_APP.h"

u8 global_test=0;
u8 Lock_state =0 ;

void Act(u8 data){
    UART_TransmitString("\r\n\r\n\r\ninside ACT 1 \r\n");
UART_Send(data);
UART_TransmitString("\r\n inside ACT 2 \r\n\r\n");

	global_test = data;
	if(data == APP_VEHICLE_UNLOCKED)
		{
		Lock_state = 1;
	    UART_TransmitString("\r\n\r\n inside GOT ACCESS \r\n\r\n");
		}
}

void NOAct(u8 data){
}

int main() {
	Port_Init(pin_cfg);
	GI_voidEnable();
	UART_Init();
	SPI_voidInit();
    Dio_WriteChannel(PA_5, STD_HIGH);

    while (1) {

		if(Lock_state == 0)
		{
			SPI_voidTransmitAsynchronous(APP_VEHICLE_ACCESS_INFO_REQUEST , Act);
            UART_TransmitString("\r\n inside LOCK StATE \r\n");
		}
		else if (Dio_ReadChannel(PA_5) == 0)
		{
			SPI_voidTransmitAsynchronous(APP_MOTORS_CONTROL_REQUEST ,NOAct);
		    UART_TransmitString("\r\n inside APP_MOTORS_CONTROL_REQUEST \r\n");
		    _delay_ms(10);
		    SPI_voidTransmitAsynchronous('W', NOAct);
		    _delay_ms(1000);


		}
		_delay_ms(10);
	}
	return 0;
}
